<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solana Meme Finder – Rug Risk Included</title>
  <style>
    :root {
      --bg: #0f0f17;
      --text: #e0e0ff;
      --accent: #00ff88;
      --link: #00ddff;
      --table-bg: #1a1a2e;
      --th-bg: #222244;
      --border: #333366;
      --buy: #004d00;
      --sell: #4d0000;
      --rug: #660000;
      --risk-low: #28a745;
      --risk-med: #ffc107;
      --risk-high: #dc3545;
      --tooltip-bg: #1e1e3a;
      --tooltip-text: #e0e0ff;
    }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
    }
    header { text-align: center; margin-bottom: 1.2rem; }
    h1 { color: var(--accent); margin: 0.4rem 0; font-size: 1.8rem; }
    p.intro { max-width: 900px; margin: 0 auto 1rem; color: #a0a0ff; font-size: 0.9rem; }
    #controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.6rem; margin-bottom: 1.2rem; }
    button {
      background: transparent;
      border: 1px solid var(--link);
      color: var(--link);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: var(--link); color: #000; }
    #wallet-info { font-weight: bold; color: #88ffaa; text-align: center; margin: 0.4rem 0; }
    #last-update, #status, #error { text-align: center; font-style: italic; margin: 0.8rem 0; font-size: 0.85rem; }
    #error { color: #ff5555; }
    #status { color: #ffcc00; }
    .table-container { overflow-x: auto; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    table { width: 100%; border-collapse: collapse; background: var(--table-bg); min-width: 1200px; }
    th, td { padding: 9px 7px; text-align: center; border: 1px solid var(--border); font-size: 0.82rem; position: relative; }
    th {
      background: var(--th-bg);
      color: #88ccff;
      position: sticky;
      top: 0;
      z-index: 1;
      cursor: pointer;
      user-select: none;
    }
    th.sortable:hover { background: #333366; }
    th .sort-arrow { margin-left: 4px; opacity: 0.6; }
    th.asc .sort-arrow:after { content: '↑'; opacity: 1; }
    th.desc .sort-arrow:after { content: '↓'; opacity: 1; }
    th[data-tooltip]:hover::after,
    th[data-tooltip]:focus::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--tooltip-bg);
      color: var(--tooltip-text);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.78rem;
      white-space: nowrap;
      z-index: 10;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      margin-bottom: 8px;
    }
    .risk-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 0.75rem;
    }
    .risk-low  { background: var(--risk-low);  color: white; }
    .risk-med  { background: var(--risk-med);  color: black; }
    .risk-high { background: var(--risk-high); color: white; }
    tr.buy-zone   { background: var(--buy); }
    tr.sell-zone  { background: var(--sell); }
    tr.rug-risk   { background: var(--rug); }
    a.link { color: var(--link); text-decoration: none; margin: 0 0.3rem; }
    a.link:hover { text-decoration: underline; }
    @media (max-width: 768px) {
      body { padding: 0.5rem; }
      th, td { padding: 7px 5px; font-size: 0.76rem; }
      table { min-width: 1100px; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Solana Meme Finder</h1>
    <p class="intro">
      Live boosted Solana tokens • m5/h6/h24 data • Rug risk score • Sortable • Tooltips • 10s refresh • ≥$5k liq
    </p>
  </header>

  <div id="controls">
    <button id="refresh-btn">Refresh</button>
    <button id="connect-btn">Connect Phantom</button>
    <div id="wallet-info">Wallet: Not connected</div>
  </div>

  <div id="last-update">Loading…</div>
  <div id="status"></div>
  <div id="error"></div>

  <div class="table-container">
    <table id="table">
      <thead>
        <tr>
          <th>Token</th>
          <th class="sortable" data-key="price"     data-type="number" data-tooltip="Current price in USD">Price</th>
          <th class="sortable" data-key="fdv"       data-type="number" data-tooltip="Fully Diluted Valuation">FDV</th>
          <th class="sortable" data-key="liq"       data-type="number" data-tooltip="Liquidity USD">Liq</th>
          <th class="sortable" data-key="m5buys"    data-type="number" data-tooltip="Buys last 5 min">m5 B</th>
          <th class="sortable" data-key="m5sells"   data-type="number" data-tooltip="Sells last 5 min">m5 S</th>
          <th class="sortable" data-key="m5vol"     data-type="number" data-tooltip="Volume last 5 min USD">m5 Vol</th>
          <th class="sortable" data-key="m5chg"     data-type="number" data-tooltip="% change last 5 min">m5 %</th>
          <th class="sortable" data-key="h6buys"    data-type="number" data-tooltip="Buys last 6 hours">h6 B</th>
          <th class="sortable" data-key="h6sells"   data-type="number" data-tooltip="Sells last 6 hours">h6 S</th>
          <th class="sortable" data-key="h6vol"     data-type="number" data-tooltip="Volume last 6 hours USD">h6 Vol</th>
          <th class="sortable" data-key="h6chg"     data-type="number" data-tooltip="% change last 6 hours">h6 %</th>
          <th class="sortable" data-key="h24buys"   data-type="number" data-tooltip="Buys last 24 hours">24h B</th>
          <th class="sortable" data-key="h24sells"  data-type="number" data-tooltip="Sells last 24 hours">24h S</th>
          <th class="sortable" data-key="h24vol"    data-type="number" data-tooltip="Volume last 24 hours USD">24h Vol</th>
          <th class="sortable" data-key="h24chg"    data-type="number" data-tooltip="% change last 24 hours">24h %</th>
          <th class="sortable" data-key="age"       data-type="number" data-tooltip="Pair age in minutes">Age</th>
          <th>Alert</th>
          <th class="sortable" data-key="boost"     data-type="number" data-tooltip="Boost amount (higher = more promoted)">Boost</th>
          <th>Rug Risk</th>
          <th>Links</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <script>
    // ─────────────────────────────────────────────────────────────────────────────
    // CONFIG & DOM
    // ─────────────────────────────────────────────────────────────────────────────

    const CONFIG = {
      BOOST_URL: 'https://api.dexscreener.com/token-boosts/latest/v1',
      SOL_MINT: 'So11111111111111111111111111111111111111112',
      MIN_LIQUIDITY: 5000,
      REFRESH_MS: 10000,
      MAX_TOKENS: 20
    };

    const DOM = {
      tbody: document.getElementById('tbody'),
      update: document.getElementById('last-update'),
      status: document.getElementById('status'),
      error: document.getElementById('error'),
      wallet: document.getElementById('wallet-info'),
      refreshBtn: document.getElementById('refresh-btn'),
      connectBtn: document.getElementById('connect-btn')
    };

    let walletAddress = null;
    let currentData = [];

    // ─────────────────────────────────────────────────────────────────────────────
    // UTILITIES
    // ─────────────────────────────────────────────────────────────────────────────

    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    function playSound(freq = 880, dur = 0.25) {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        osc.type = 'sine';
        osc.frequency.value = freq;
        osc.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + dur);
      } catch {}
    }

    // ─────────────────────────────────────────────────────────────────────────────
    // WALLET
    // ─────────────────────────────────────────────────────────────────────────────

    async function connectWallet() {
      if (!window.solana?.isPhantom) {
        alert('Install Phantom wallet');
        return;
      }
      try {
        const resp = await window.solana.connect();
        walletAddress = resp.publicKey.toString();
        DOM.wallet.textContent = `Wallet: ${walletAddress.slice(0,6)}…${walletAddress.slice(-4)}`;
      } catch (err) {
        alert('Connection failed: ' + err.message);
      }
    }

    // ─────────────────────────────────────────────────────────────────────────────
    // DATA FLOW
    // ─────────────────────────────────────────────────────────────────────────────

    async function fetchBoostedTokens() {
      const boosts = await fetchJson(CONFIG.BOOST_URL);
      return boosts.filter(b => b.chainId === 'solana').slice(0, CONFIG.MAX_TOKENS);
    }

    async function fetchPair(tokenAddress) {
      try {
        const res = await fetchJson(`https://api.dexscreener.com/latest/dex/tokens/${tokenAddress}`);
        return res.pairs?.[0] || null;
      } catch {
        return null;
      }
    }

    function createRowData(pair, boost) {
      if (!pair || (pair.liquidity?.usd || 0) < CONFIG.MIN_LIQUIDITY) return null;

      const age = pair.pairCreatedAt ? Math.round((Date.now() - pair.pairCreatedAt) / 60000) : 999999;

      const m5 = pair.txns?.m5 || {};
      const h6 = pair.txns?.h6 || {};
      const h24 = pair.txns?.h24 || {};

      const m5chg = pair.priceChange?.m5 || 0;
      const liq = pair.liquidity?.usd || 0;
      const fdv = pair.fdv || 0;

      let zone = '';
      let soundFreq = 0;
      let soundDur = 0.25;

      if (m5.sells > m5.buys * 2.8 || m5chg < -35 || liq / fdv < 0.05) {
        zone = 'RUG ⚠️';
        soundFreq = 300; soundDur = 0.6;
      } else if (m5.sells > m5.buys * 1.8 && m5chg < -8) {
        zone = 'SELL ↓';
        soundFreq = 500; soundDur = 0.4;
      } else if (m5.buys > m5.sells * 1.8 && m5chg > 9 && (pair.volume?.m5 || 0) > 8000) {
        zone = 'BUY ↑';
        soundFreq = 1100; soundDur = 0.35;
      }

      // Rug Risk Score (0–100, higher = riskier)
      let rugRisk = 0;
      if (liq / fdv < 0.05) rugRisk += 40;
      if (m5.sells > m5.buys * 2.5) rugRisk += 30;
      if (m5chg < -25) rugRisk += 20;
      if (liq < 10000) rugRisk += 20;
      rugRisk = Math.min(100, rugRisk);

      let riskLevel = 'Low';
      let riskClass = 'risk-low';
      if (rugRisk >= 60) {
        riskLevel = 'High';
        riskClass = 'risk-high';
      } else if (rugRisk >= 30) {
        riskLevel = 'Medium';
        riskClass = 'risk-med';
      }

      return {
        symbol: pair.baseToken.symbol || boost.symbol || '–',
        price: (pair.priceUsd || '0').toString(),
        fdv: fdv ? fdv.toLocaleString() : '–',
        liq: liq ? liq.toLocaleString() : '–',
        m5buys: m5.buys || 0,
        m5sells: m5.sells || 0,
        m5vol: (pair.volume?.m5 || 0).toLocaleString(),
        m5chg: m5chg.toFixed(1) + '%',
        h6buys: h6.buys || 0,
        h6sells: h6.sells || 0,
        h6vol: (pair.volume?.h6 || 0).toLocaleString(),
        h6chg: (pair.priceChange?.h6 || 0).toFixed(1) + '%',
        h24buys: h24.buys || 0,
        h24sells: h24.sells || 0,
        h24vol: (pair.volume?.h24 || 0).toLocaleString(),
        h24chg: (pair.priceChange?.h24 || 0).toFixed(1) + '%',
        age,
        zone,
        soundFreq,
        soundDur,
        boost: boost.totalAmount || boost.amount || '–',
        rugRisk: rugRisk,
        riskLevel,
        riskClass,
        ds: pair.url || `https://dexscreener.com/solana/${boost.tokenAddress}`,
        pump: `https://pump.fun/${boost.tokenAddress}`,
        jup: `https://jup.ag/swap/${CONFIG.SOL_MINT}-${boost.tokenAddress}`
      };
    }

    async function loadData(silent = false) {
      DOM.error.textContent = '';
      DOM.status.textContent = 'Fetching latest boosted Solana tokens...';

      try {
        const boosts = await fetchBoostedTokens();

        DOM.status.textContent = boosts.length
          ? `Loaded ${boosts.length} boosted tokens`
          : 'No boosted tokens found – retrying soon';

        const rows = await Promise.all(
          boosts.map(async boost => {
            const pair = await fetchPair(boost.tokenAddress);
            return createRowData(pair, boost);
          })
        );

        currentData = rows.filter(Boolean);
        renderTable(currentData);

        DOM.update.textContent = `Updated: ${new Date().toLocaleTimeString()} (auto 10s)`;
      } catch (err) {
        DOM.error.textContent = `Error: ${err.message}`;
      }
    }

    function renderTable(data) {
      DOM.tbody.innerHTML = '';
      let hasSound = false;

      if (data.length === 0) {
        DOM.tbody.innerHTML = '<tr><td colspan="21" style="padding:2rem;color:#ffcc00;">No active boosted tokens right now</td></tr>';
        return;
      }

      data.forEach(r => {
        const tr = document.createElement('tr');
        tr.className = r.zone.includes('BUY') ? 'buy-zone' :
                       r.zone.includes('SELL') ? 'sell-zone' :
                       r.zone.includes('RUG') ? 'rug-risk' : '';

        tr.innerHTML = `
          <td>${r.symbol}</td>
          <td>$${r.price}</td>
          <td>$${r.fdv}</td>
          <td>$${r.liq}</td>
          <td>${r.m5buys}</td><td>${r.m5sells}</td><td>$${r.m5vol}</td><td>${r.m5chg}</td>
          <td>${r.h6buys}</td><td>${r.h6sells}</td><td>$${r.h6vol}</td><td>${r.h6chg}</td>
          <td>${r.h24buys}</td><td>${r.h24sells}</td><td>$${r.h24vol}</td><td>${r.h24chg}</td>
          <td>${r.age}</td>
          <td>${r.zone || '–'}</td>
          <td>${r.boost}</td>
          <td><span class="risk-badge ${r.riskClass}">${r.riskLevel} (${r.rugRisk}%)</span></td>
          <td>
            <a href="${r.ds}"   target="_blank" class="link">Dex</a>
            <a href="${r.pump}" target="_blank" class="link">Pump</a>
            <a href="${r.jup}"  target="_blank" class="link">Jup</a>
          </td>
        `;
        DOM.tbody.appendChild(tr);

        if (r.soundFreq > 0) {
          playSound(r.soundFreq, r.soundDur);
          hasSound = true;
        }
      });

      if (hasSound) setTimeout(() => playSound(1400, 0.15), 400);
    }

    function getNumericValue(item, key) {
      const clean = v => parseFloat(String(v).replace(/[^0-9.-]+/g,'')) || 0;
      if (key === 'price') return clean(item.price);
      if (key === 'fdv' || key === 'liq' || key.endsWith('vol')) return clean(item[key]);
      if (key.endsWith('chg')) return clean(item[key]);
      if (key.endsWith('buys') || key.endsWith('sells')) return item[key] || 0;
      if (key === 'age') return parseInt(item.age) || 999999;
      if (key === 'boost') return parseInt(item.boost) || 0;
      return 0;
    }

    function handleSort(e) {
      const th = e.target.closest('th.sortable');
      if (!th) return;

      const key = th.dataset.key;
      const dir = th.classList.contains('asc') ? 'desc' : 'asc';

      document.querySelectorAll('th.sortable').forEach(el => el.classList.remove('asc', 'desc'));
      th.classList.add(dir);

      currentData.sort((a, b) => {
        const va = getNumericValue(a, key);
        const vb = getNumericValue(b, key);
        return dir === 'desc' ? vb - va : va - vb;
      });

      renderTable(currentData);
    }

    // ─────────────────────────────────────────────────────────────────────────────
    // INIT & EVENTS
    // ─────────────────────────────────────────────────────────────────────────────

    DOM.refreshBtn.addEventListener('click', () => loadData());
    DOM.connectBtn.addEventListener('click', connectWallet);
    document.querySelector('thead').addEventListener('click', handleSort);

    // Start
    loadData();
    setInterval(() => loadData(true), CONFIG.REFRESH_MS);
  </script>
</body>
</html>
